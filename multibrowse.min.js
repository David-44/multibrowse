(function(a){var f=a(".multibrowse"),g=a(".mb_submit"),k=a(".mb_reset"),d=a(".multibrowse input:file"),p=d.filter(":first").prop("attributes"),l=0,q={maxNumberOfInputs:f.data("mb-inputs-max"),maxFileSize:a("input[name='MAX_FILE_SIZE']").attr("value"),maxTotalSize:f.data("mb-total-size"),previewWidth:f.data("mb-preview-width")};g[0].disabled=!1;a.fn.addFileInput=function(b){var c=a.extend({maxNumberOfInputs:3,maxFileSize:1E6,maxTotalSize:5E6,previewWidth:200},b);f.on("change","input:file",function(){d=
a(".multibrowse input:file");l=d.length;var b=d.filter(":last").val()&&l<c.maxNumberOfInputs;if(this.files[0].size>c.maxFileSize){var e="The file "+this.files[0].name+" has the size ",e=e+(h(this.files[0].size)+"<br>"),e=e+("The maximum file size is "+h(c.maxFileSize));m(e)}else n()>c.maxTotalSize?(e="The total file size is "+(h(n())+"<br>"),e+="The maximum file size is "+h(c.maxTotalSize),m(e)):(g[0].disabled=!1,a(".mb-message").length&&a(".mb-message").remove());r(a(this),c.previewWidth);b&&t(p)});
k.length&&k.click(function(b){b.preventDefault();a(".multipreview").remove();a("input:file").not(":first").remove();a("input:file").val("");g[0].disabled=!1;a(".mb-message").remove()});return this};var m=function(b){var c=a('<p class="mb-message"></p>');c.html(b);f.prepend(c);g[0].disabled=!0;addNewInput=!1},t=function(b){var c=a("<div class='mb_wrapper'></div>"),d=a("<input>");a.each(b,function(){"id"==this.name||"name"==this.name?d.attr(this.name,this.value+(a(".multibrowse input:file").length+
1)):d.attr(this.name,this.value)});c.append(d);a(".multibrowse .mb_wrapper:last").after(c)},r=function(b,c){$preview=a("<img>");$preview.addClass("multipreview").width(c);var d=new FileReader;d.onload=function(b){$preview.attr("src",b.target.result)};d.readAsDataURL(b[0].files[0]);b.next().is("img")&&b.next().remove();b.parent().append($preview)},h=function(b){var a=-1;do b/=1E3,a++;while(1E3<b);return Math.max(b,.1).toFixed(1)+[" kB"," MB"," GB"][a]},n=function(){var a=0;d.each(function(c){if(void 0==
d[c].files[0])return!0;a+=d[c].files[0].size});return a};f.addFileInput(q)})(jQuery);