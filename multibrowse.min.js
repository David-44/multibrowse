(function(a){var d=a(".multibrowse"),f=a(".mb_submit"),g=a(".mb_reset");f[0].disabled=!1;var h={maxNumberOfInputs:d.attr("mb-inputs-max"),maxFileSize:a("input[name='MAX_FILE_SIZE']").attr("value"),maxTotalSize:d.attr("mb-total-size"),previewWidth:d.attr("mb-preview-width")};a.fn.addFileInput=function(e){var c=a.extend({maxNumberOfInputs:5,maxFileSize:1E6,maxTotalSize:5E6,previewWidth:200},e);d.delegate("input:file","change",function(){var b=a(".multibrowse input:file"),e=b.filter(":first").prop("attributes"),
g=b.length,b=b.filter(":last").val()&&g<c.maxNumberOfInputs;this.files[0].size>c.maxFileSize?(b="The file "+this.files[0].name+" has the size ",b+=d.addFileInput.getReadableFileSize(this.files[0].size)+"<br>",b+="The maximum file size is "+d.addFileInput.getReadableFileSize(c.maxFileSize),d.addFileInput.writeMessage(b),f[0].disabled=!0,b=!1):d.addFileInput.totalSize()>c.maxTotalSize?(b="The total file size is "+(d.addFileInput.getReadableFileSize(d.addFileInput.totalSize())+"<br>"),b+="The maximum file size is "+
d.addFileInput.getReadableFileSize(c.maxTotalSize),d.addFileInput.writeMessage(b),f[0].disabled=!0,b=!1):(f[0].disabled=!1,a(".mb-message").length&&a(".mb-message").remove());d.addFileInput.generatePreview(a(this),c.previewWidth);b&&d.addFileInput.createFileInput(e)});g.length&&g.click(function(b){b.preventDefault();a(".multipreview").remove();a("input:file").not(":first").remove();a("input:file").val("");f[0].disabled=!1;a(".mb-message").remove()})};a.fn.addFileInput.createFileInput=function(e){var c=
a("<div class='mb_wrapper'></div>"),b=a("<input>");a.each(e,function(){"id"==this.name||"name"==this.name?b.attr(this.name,this.value+(a(".multibrowse input:file").length+1)):b.attr(this.name,this.value)});c.append(b);a(".multibrowse .mb_wrapper:last").after(c)};a.fn.addFileInput.generatePreview=function(e,c){$preview=a("<img>");$preview.addClass("multipreview").width(c);var b=new FileReader;b.onload=function(b){$preview.attr("src",b.target.result)};b.readAsDataURL(e[0].files[0]);e.next().is("img")&&
e.next().remove();e.parent().append($preview)};a.fn.addFileInput.writeMessage=function(e){var c=a('<p class="mb-message"></p>');c.html(e);d.prepend(c)};a.fn.addFileInput.getReadableFileSize=function(a){var c=-1;do a/=1E3,c++;while(1E3<a);return Math.max(a,.1).toFixed(1)+[" kB"," MB"," GB"][c]};a.fn.addFileInput.totalSize=function(){var d=0,c=a(".multibrowse input:file");c.each(function(a){if(void 0==c[a].files[0])return!0;d+=c[a].files[0].size});return d};d.addFileInput(h)})(jQuery);